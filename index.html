<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>空気線図計算</title>
  <style>
    :root {
      --fg:#222; --muted:#666; --accent:#0a7; --err:#c22;
    }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", sans-serif;
      margin: 0; color: var(--fg); background:#fafafa;
    }
    header { padding: 16px 20px; background:#fff; border-bottom:1px solid #eee; position: sticky; top:0; }
    header h1 { font-size: 18px; margin: 0; }
    main { padding: 16px; max-width: 900px; margin: 0 auto; }
    .card { background:#fff; border:1px solid #eee; border-radius: 12px; padding: 16px; margin-bottom: 16px; }

    /* 入力行のベースレイアウト */
    .pair { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
    .row { display:grid; grid-template-columns: 0.8fr 1fr 0.4fr; gap:8px; align-items:center; }
    @media (max-width:600px){
      .pair { grid-template-columns: 1fr; }
      .row { grid-template-columns: 0.9fr 1fr 0.4fr; }
    }

    label { font-size:13px; color:var(--muted); white-space:nowrap; }
    input[type="number"] {
      width:100%; box-sizing:border-box; padding:8px 10px; border-radius:10px;
      border:1px solid #ddd; font-size:16px;
    }
    .unit { white-space:nowrap; color:#555; font-size:14px; }

    .actions { display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    button { appearance:none; border:none; border-radius:10px; padding:10px 14px; font-size:16px; cursor:pointer; }
    .primary { background:var(--accent); color:#fff; }
    .secondary { background:#eee; color:#333; }
    .msg { margin:8px 0; font-size:14px; }
    .msg.ok { color:var(--accent); }
    .msg.err { color:var(--err); }

    table { width:100%; border-collapse:collapse; }
    th, td { padding:8px 6px; border-bottom:1px solid #eee; text-align:right; }
    th:nth-child(1), td:nth-child(1){ text-align:left; }

    footer { padding:16px; text-align:center; color:#888; font-size:13px; }
  </style>
</head>
<body>
  <header><h1>空気線図計算</h1></header>
  <main>
    <section class="card">
      <h2 style="margin:0 0 10px 0; font-size:16px;">入力</h2>

      <!-- 吸込ペア -->
      <div class="pair">
        <div class="row"><label>吸込乾球温度</label><input id="T_in" type="number" step="0.1" /><span class="unit">°C(DB)</span></div>
        <div class="row"><label>吸込相対湿度</label><input id="RH_in" type="number" step="0.1" /><span class="unit">%RH</span></div>
      </div>

      <!-- 冷却後ペア -->
      <div class="pair">
        <div class="row"><label>冷却後乾球温度</label><input id="T_out" type="number" step="0.1" /><span class="unit">°C(DB)</span></div>
        <div class="row"><label>冷却後相対湿度</label><input id="RH_out" type="number" step="0.1" /><span class="unit">%RH</span></div>
      </div>

      <!-- 風量・能力ペア -->
      <div class="pair">
        <div class="row"><label>風量（任意）</label><input id="V" type="number" step="0.1" /><span class="unit">m³/min</span></div>
        <div class="row"><label>冷却能力（任意）</label><input id="Q" type="number" step="0.1" /><span class="unit">kW</span></div>
      </div>

      <div class="actions">
        <button id="calc" class="primary">計算</button>
        <button id="clear" class="secondary">クリア</button>
      </div>
      <div id="msg" class="msg"></div>
    </section>

    <section id="resultsCard" class="card" style="display:none;">
      <h2 style="margin:0 0 10px 0; font-size:16px;">計算結果</h2>
      <table>
        <tbody>
          <tr><th>風量 V</th><td><span id="rV">-</span></td><td class="unit">m³/min</td></tr>
          <tr><th>冷却能力 Q</th><td><span id="rQ">-</span></td><td class="unit">kW</td></tr>
          <tr><th>除湿量</th><td><span id="rL">-</span></td><td class="unit">L/h</td></tr>
          <tr><th>質量流量 ṁ</th><td><span id="rm">-</span></td><td class="unit">kg/s</td></tr>
        </tbody>
      </table>
    </section>
  </main>
  <footer>© 空気線図計算</footer>

  <script>
    const P_ATM=101.325,R_AIR=0.287,C_A=1.006,C_W=1.86,H_W=2501.0;
    const ps=T=>0.61078*Math.exp((17.27*T)/(T+237.3));
    const x_from_phi=(phi,T)=>{const pv=phi*ps(T);return 0.622*pv/(P_ATM-pv);};
    const h_air=(T,x)=>C_A*T+x*(H_W+C_W*T);
    const v_sp=(T,x)=>(R_AIR*(T+273.15)/P_ATM)*(1+1.6078*x);
    const fnum=v=>{const n=Number(v);return Number.isFinite(n)?n:null;};
    const fmt=(v,n=1)=>Number.isFinite(v)?v.toFixed(n):"-";

    const $=id=>document.getElementById(id);

    function compute(){
      const msg=$("msg"),card=$("resultsCard");msg.textContent="";card.style.display="none";
      const T1=fnum($("T_in").value),H1=fnum($("RH_in").value),
            T2=fnum($("T_out").value),H2=fnum($("RH_out").value),
            V=fnum($("V").value),Q=fnum($("Q").value);
      if([T1,H1,T2,H2].some(v=>v===null)){msg.textContent="吸込T/φ・冷却T/φは必須です。";return;}
      if(V===null&&Q===null){msg.textContent="風量または冷却能力を入力してください。";return;}

      const x1=x_from_phi(H1/100,T1),h1=h_air(T1,x1),v1=v_sp(T1,x1);
      const x2=x_from_phi(H2/100,T2),h2=h_air(T2,x2);
      let m_dot=null,q=Q,v=V;
      if(v!=null)m_dot=(v/60)/v1;
      if(q==null){if(m_dot==null){msg.textContent="内部エラー";return;}q=m_dot*(h1-h2);}
      if(v==null){const dh=h1-h2;if(Math.abs(dh)<1e-9){msg.textContent="Δh≈0で逆算不可";return;}
        m_dot=q/dh;v=m_dot*60*v1;}
      const L=(x1-x2)*m_dot*3600;
      $("rV").textContent=fmt(v,1);
      $("rQ").textContent=fmt(q,1);
      $("rL").textContent=fmt(L,1);
      $("rm").textContent=fmt(m_dot,4);
      msg.textContent="計算しました。";msg.classList.add("ok");card.style.display="block";
    }

    function clearAll(){
      ["T_in","RH_in","T_out","RH_out","V","Q"].forEach(id=>$(id).value="");
      $("resultsCard").style.display="none";
      $("msg").textContent="";
    }

    $("calc").onclick=compute;
    $("clear").onclick=clearAll;
  </script>
</body>
</html>
